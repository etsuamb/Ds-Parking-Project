openapi: 3.0.3
info:
  title: Distributed Smart Parking System API
  description: |
    OpenAPI specification for the Distributed Smart Parking System. All client requests go through the API Gateway. Authentication uses JWT. Admin access is role-based.
  version: 1.0.0
servers:
- url: http://localhost:8080
  description: API Gateway
tags:
- name: Auth
- name: Parking
- name: Booking
- name: Admin
paths:
  /auth/register:
    post:
      tags:
      - Auth
      summary: Register a new user
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RegisterRequest"
        required: true
      responses:
        "201":
          description: User registered successfully
        "400":
          description: Invalid input
  /auth/login:
    post:
      tags:
      - Auth
      summary: Login user or admin
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LoginRequest"
        required: true
      responses:
        "200":
          description: Login successful
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthResponse"
        "401":
          description: Invalid credentials
  /parking/lots:
    get:
      tags:
      - Parking
      summary: Get all parking lots
      responses:
        "200":
          description: List of parking lots
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ParkingLot"
  /parking/lots/{lotId}:
    get:
      tags:
      - Parking
      summary: Get parking lot details
      parameters:
      - name: lotId
        in: path
        required: true
        schema:
          type: integer
      responses:
        "200":
          description: Parking lot details
        "404":
          description: Lot not found
  /bookings:
    post:
      tags:
      - Booking
      summary: Create a booking
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/bookings_body"
        required: true
      responses:
        "201":
          description: Booking created
        "401":
          description: Unauthorized
      security:
      - BearerAuth: []
  /bookings/{id}:
    get:
      tags:
      - Booking
      summary: Get booking by ID
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
      responses:
        "200":
          description: Booking details
        "404":
          description: Booking not found
      security:
      - BearerAuth: []
    delete:
      tags:
      - Booking
      summary: Cancel booking
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
      responses:
        "200":
          description: Booking cancelled
      security:
      - BearerAuth: []
  /bookings/user/me:
    get:
      tags:
      - Booking
      summary: Get bookings for logged-in user
      responses:
        "200":
          description: User bookings list
      security:
      - BearerAuth: []
  /admin/bookings:
    get:
      tags:
      - Admin
      summary: Admin - View all bookings
      responses:
        "200":
          description: List of all bookings
        "403":
          description: Admin access required
      security:
      - BearerAuth: []
  /admin/bookings/{id}/cancel:
    post:
      tags:
      - Admin
      summary: Admin - Force cancel booking
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
      responses:
        "200":
          description: Booking cancelled by admin
        "403":
          description: Admin access required
      security:
      - BearerAuth: []
  /admin/parking/lots:
    post:
      tags:
      - Admin
      summary: Admin - Create parking lot
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/parking_lots_body"
        required: true
      responses:
        "201":
          description: Parking lot created
        "403":
          description: Admin access required
      security:
      - BearerAuth: []
components:
  schemas:
    RegisterRequest:
      required:
      - email
      - password
      type: object
      properties:
        email:
          type: string
          example: user@example.com
        password:
          type: string
          example: password123
    LoginRequest:
      required:
      - email
      - password
      type: object
      properties:
        email:
          type: string
        password:
          type: string
    AuthResponse:
      type: object
      properties:
        token:
          type: string
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
    ParkingLot:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        availableSpots:
          type: integer
    Booking:
      type: object
      properties:
        id:
          type: integer
        userId:
          type: integer
        lotId:
          type: integer
        spotNumber:
          type: integer
        status:
          type: string
          example: CONFIRMED
    bookings_body:
      required:
      - lotId
      type: object
      properties:
        lotId:
          type: integer
    parking_lots_body:
      required:
      - name
      type: object
      properties:
        name:
          type: string
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
