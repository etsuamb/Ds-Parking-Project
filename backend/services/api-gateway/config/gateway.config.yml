http:
  port: 8080

admin:
  port: 9876
  host: localhost

# === POLICIES ===
policies:
  - cors          # ← Added for frontend CORS
  - proxy

# === API ENDPOINTS (Public paths exposed by gateway) ===
apiEndpoints:
  auth:
    paths:
      - /auth
      - /auth/*

  bookings:
    paths:
      - /bookings
      - /bookings/*

  admin-bookings:
    paths:
      - /admin/bookings
      - /admin/bookings/*

  parking:
    paths:
      - /parking
      - /parking/*

  admin-parking:
    paths:
      - /admin/parking
      - /admin/parking/*

  notifications:   # ← New: for WebSocket
    paths:
      - /socket.io
      - /socket.io/*

# === SERVICE ENDPOINTS (Internal Docker service names + ports) ===
serviceEndpoints:
  auth-service:
    url: http://auth-service:3000

  booking-service:
    url: http://booking-service:3001

  parking-service:
    url: http://parking-service:3002

  notification-service:   # ← New: for WebSocket
    url: http://notification-service:4000

# === PIPELINES (Connect public paths to internal services) ===
pipelines:
  auth-pipeline:
    apiEndpoints:
      - auth
    policies:
      - cors:                     # ← Allow frontend
          - action:
              origin: ["http://localhost:5173", "http://localhost:5174"]
              methods: GET,POST,PUT,DELETE,OPTIONS
              credentials: true
              allowedHeaders:
                - Content-Type
                - Authorization
      - proxy:
          - action:
              serviceEndpoint: auth-service

  bookings-pipeline:
    apiEndpoints:
      - bookings
    policies:
      - cors:                     # ← Same for bookings
          - action:
              origin: "http://localhost:5173"
              methods: GET,POST,PUT,DELETE,OPTIONS
              credentials: true
              allowedHeaders:
                - Content-Type
                - Authorization
      - proxy:
          - action:
              serviceEndpoint: booking-service

  admin-bookings-pipeline:
    apiEndpoints:
      - admin-bookings
    policies:
      - cors:                     # ← CORS for admin bookings
          - action:
              origin: ["http://localhost:5173", "http://localhost:5174"]
              methods: GET,POST,PUT,DELETE,OPTIONS
              credentials: true
              allowedHeaders:
                - Content-Type
                - Authorization
      - proxy:
          - action:
              serviceEndpoint: booking-service

  admin-parking-pipeline:
    apiEndpoints:
      - admin-parking
    policies:
      - cors:                     # ← CORS for admin parking
          - action:
              origin: ["http://localhost:5173", "http://localhost:5174"]
              methods: GET,POST,PUT,DELETE,OPTIONS
              credentials: true
              allowedHeaders:
                - Content-Type
                - Authorization
      - proxy:
          - action:
              serviceEndpoint: parking-service

  parking-pipeline:
    apiEndpoints:
      - parking
    policies:
      - cors:                     # ← Same for parking
          - action:
              origin: "http://localhost:5173"
              methods: GET,POST,PUT,DELETE,OPTIONS
              credentials: true
      - proxy:
          - action:
              serviceEndpoint: parking-service

  notifications-pipeline:       # ← New: WebSocket proxy
    apiEndpoints:
      - notifications
    policies:
      - proxy:
          - action:
              serviceEndpoint: notification-service
              ws: true              # ← Critical: enables WebSocket proxying